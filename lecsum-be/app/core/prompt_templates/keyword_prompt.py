from langchain_core.prompts import ChatPromptTemplate

def get_keyword_prompt() -> ChatPromptTemplate:

    # -------------------------------
    # Few-shot Set A — 정상 케이스
    # -------------------------------
    ex1_context = """
    자연어 처리(NLP)는 인간의 언어를 컴퓨터가 이해하고 처리하도록 하는 AI 분야이다.
    주요 기술로는 형태소 분석, 구문 분석, 의미 분석 등이 있으며 최근 Transformer 모델이 성능을 크게 향상시켰다.
    """
    ex1_output = "자연어 처리, NLP, 형태소 분석, 구문 분석, 의미 분석, Transformer"

    ex2_context = """
    객체 지향 프로그래밍(OOP)은 객체 간 상호작용으로 프로그램을 구성하는 패러다임이다.
    핵심 개념은 캡슐화, 상속, 다형성, 추상화이며 클래스와 인스턴스를 기반으로 구조를 설계한다.
    """
    ex2_output = "객체 지향 프로그래밍, OOP, 캡슐화, 상속, 다형성, 추상화, 클래스, 인스턴스"

    ex3_context = """
    머신러닝은 데이터로부터 패턴을 학습하여 예측 모델을 만드는 기술이다.
    대표 알고리즘으로는 회귀 분석, SVM, 결정 트리, 앙상블 학습 등이 있다.
    """
    ex3_output = "머신러닝, 회귀 분석, SVM, 결정 트리, 앙상블 학습"

    # -------------------------------
    # Few-shot Set B — 교정형(핵심)
    # 모델이 잘못 출력한 버전을 보여주고 → 올바른 답을 제시
    # -------------------------------
    ex4_context = """
    네트워크 계층 모델 OSI 7계층은 응용, 표현, 세션, 전송, 네트워크, 데이터 링크, 물리 계층으로 구성된다.
    각 계층은 역할이 구분되어 있으며 프로토콜 설계에 활용된다.
    """
    ex4_wrong = "응용, 표현, 세션, 전송, 네트워크, 데이터 링크, 물리, 프로토콜"
    ex4_corrected = "OSI 7계층, 응용 계층, 표현 계층, 세션 계층, 전송 계층, 네트워크 계층, 데이터 링크 계층, 물리 계층"

    ex5_context = """
    데이터베이스 트랜잭션은 원자성, 일관성, 독립성, 지속성(ACID)을 보장해야 한다.
    이는 시스템 장애나 동시성 문제 발생 시 데이터 무결성을 유지하기 위한 핵심 개념이다.
    """
    ex5_wrong = "트랜잭션, 원자성, 일관성, 독립성, 지속성, 동시성, 무결성"
    ex5_corrected = "트랜잭션, ACID, 원자성, 일관성, 독립성, 지속성, 데이터 무결성"

    # -------------------------------
    # Few-shot Set C — 장문 요약에서 키워드만 골라내는 케이스
    # -------------------------------
    ex6_context = """
    딥러닝 기반 컴퓨터 비전 기술은 이미지 분류, 객체 탐지, 시맨틱 세그멘테이션,
    이미지 생성 등 다양한 응용 분야를 갖는다.
    CNN 구조는 합성곱 연산을 기반으로 하며 최근에는 Vision Transformer(ViT)가 대체 기술로 부상하고 있다.
    """
    ex6_output = "컴퓨터 비전, 이미지 분류, 객체 탐지, 시맨틱 세그멘테이션, 이미지 생성, CNN, Vision Transformer, ViT"

    # -------------------------------
    # Prompt Construction
    # -------------------------------
    return ChatPromptTemplate.from_messages([
        (
            "system",
            """
            당신은 최고 수준의 '교육 콘텐츠 지식 추출 전문가'다.
            당신의 목적은 주어진 [텍스트]에서 **핵심 개념만 추출하여 키워드로 구조화**하는 것이다.

            ========================================
            [키워드 추출 규칙]

            1. **개념 중심 추출(Concept-level Extraction)**
            - 기술명/이론명/모델명/구조/패러다임/프로세스/구성요소 등 ‘지식 단위’를 선택
            - 문장형 설명, 예시, 서술형 표현 제외

            2. **10개 이내로 제한**

            3. **정규화(Normalization)**
            - 동일 개념은 단일 키워드로 통합
            - 불필요한 일반 단어 제거 (예: 과정, 방식, 사용, 예시, 설명)

            4. **중복 제거 + 의미 단위 유지**
            - 복합 개념은 유지하되, 불필요한 수식어 제거
            - 예: “Transformer 기반 딥러닝 모델” → “Transformer”

            5. **출력 형식**
            - 쉼표(,)로 구분한 한 줄
            - 설명, 불릿, 문장 금지
            - JSON 금지

            ========================================
            [Few-shot 예시(정상 케이스)]
            """
        ),

        # 정상 예시 1
        ("human", f"텍스트:\n{ex1_context}"),
        ("ai", ex1_output),

        # 정상 예시 2
        ("human", f"텍스트:\n{ex2_context}"),
        ("ai", ex2_output),

        # 정상 예시 3
        ("human", f"텍스트:\n{ex3_context}"),
        ("ai", ex3_output),

        # 교정형 예시 4
        ("human", f"텍스트:\n{ex4_context}\n(모델이 잘못 출력한 예: {ex4_wrong})"),
        ("ai", ex4_corrected),

        # 교정형 예시 5
        ("human", f"텍스트:\n{ex5_context}\n(모델이 잘못 출력한 예: {ex5_wrong})"),
        ("ai", ex5_corrected),

        # 장문 예시 6
        ("human", f"텍스트:\n{ex6_context}"),
        ("ai", ex6_output),

        # 실제 입력
        ("human", "텍스트:\n{context}")
    ])